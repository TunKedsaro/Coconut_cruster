# prepare pickle
import pickle
import numpy as np

# Dummy input
embedding = np.array([[1.2563543319702148,0.4909029006958008,-0.28432154655456543,-1.0022549629211426,0.214186429977417,1.1438922882080078,0.9304967522621155,0.5215048789978027,0.6694207787513733,-0.4339843988418579,-0.10054019093513489,0.7759847044944763,-0.5690432786941528,-1.623992681503296,-0.13535428047180176,1.5060172080993652,0.7928709983825684,-1.6784807443618774,-1.1172764301300049,0.64400315284729,0.731101393699646,0.6065155267715454,0.035147830843925476,0.6681005358695984,-2.6416118144989014,-0.3658241927623749,0.8189182281494141,0.6231244802474976,0.8450209498405457,-0.6636059284210205,2.129429340362549,-0.6168339848518372,1.645894169807434,-0.8221967220306396,0.14332129061222076,-1.605381727218628,-2.149899959564209,-1.3149508237838745,-1.7191731929779053,1.3647387027740479,-0.6217135190963745,-0.9275895953178406,-0.20817556977272034,0.09388530254364014,-0.5606676340103149,0.8289625644683838,0.4598715901374817,0.011929228901863098,2.362654209136963,1.190519094467163,-0.8800344467163086,-1.1784520149230957,-0.3625551164150238,-0.9923568964004517,-0.9512477517127991,0.5394910573959351,0.1408340334892273,-1.715447187423706,-1.1397655010223389,-0.40380531549453735,0.45463594794273376,-1.761748194694519,-0.11130276322364807,0.33200058341026306,0.04925939440727234,-0.7124141454696655,0.707421064376831,-1.5119799375534058,-1.1583460569381714,0.10021299123764038,-1.5758719444274902,0.490784615278244,-0.22914175689220428,-1.6251037120819092,1.1045094728469849,1.0134762525558472,1.3269670009613037,0.32034561038017273,0.4325120151042938,1.272377371788025,1.4995193481445312,-0.9098921418190002,-0.22453820705413818,-0.9393042325973511,0.8279298543930054,-0.30945324897766113,0.6080929040908813,-1.0174401998519897,2.164128303527832,1.0206342935562134,-0.8939098119735718,1.6062926054000854,1.1871107816696167,-1.419877052307129,-0.8857449889183044,0.7688724398612976,0.08461323380470276,-0.9672144055366516,0.058370329439640045,0.25360652804374695,-0.9577913284301758,-0.39149197936058044,-0.30199891328811646,-1.1394962072372437,0.45182928442955017,0.40443769097328186,-0.28863203525543213,-1.379481554031372,0.6877384185791016,0.07187604904174805,0.0631825402379036,1.9142019748687744,0.22913675010204315,0.33429235219955444,0.699988603591919,0.0324508398771286,-0.02291443943977356,0.7297816276550293,-1.028542399406433,-0.8536001443862915,0.2900281250476837,0.5221160650253296,0.10718677192926407,-1.8222618103027344,0.5967996716499329,1.4286237955093384,1.6146178245544434,-0.05321875214576721,0.807341992855072,1.7509781122207642,1.560505747795105,-0.2589641213417053,0.7825079560279846,-0.17146164178848267,-0.5582916736602783,0.676531195640564,1.0885396003723145,0.09959814697504044,0.017429862171411514,0.7579262852668762,0.5202345848083496,0.1235172301530838,-1.0818731784820557,-2.0239622592926025,-0.050670918077230453,0.25517183542251587,1.6352386474609375,0.9171701669692993,-0.5598781108856201,0.7248640656471252,0.08268046379089355,0.3100130558013916,-1.1889947652816772,-0.935395359992981,-1.6843656301498413,0.10045456886291504,0.28691065311431885,-0.36533576250076294,0.580580472946167,0.03957982733845711,-2.179837942123413,0.1380189061164856,-2.0534348487854004,-1.2206937074661255,0.5596510171890259,-0.9810027480125427,-0.6747759580612183,0.6980769634246826,-0.5568063259124756,0.7591810822486877,-0.2871832549571991,0.17539042234420776,-0.8028270602226257,-0.8342251181602478,0.007787644863128662,0.03394819796085358,1.0653103590011597,-1.6248224973678589,-0.767850399017334,0.5459803342819214,-1.144881248474121,0.08072386682033539,0.49467629194259644,1.9075374603271484,0.8862840533256531,0.6771034002304077,-2.245887517929077,1.1809577941894531,-0.9510422945022583,-0.7297254204750061,-1.412399172782898,1.1074883937835693,-0.025431953370571136,-0.0007354170083999634,0.29572129249572754,-0.33636248111724854,-0.1862865686416626,-0.08573734760284424,0.350726455450058,-1.5382105112075806,0.5586365461349487,0.2719656825065613,-0.25774723291397095,-0.09748920798301697,0.22168336808681488,-0.36375555396080017,0.2744395136833191,0.5825201272964478,1.7114369869232178,1.2431668043136597,-0.1454278826713562,0.9836690425872803,0.670009434223175,-1.282932996749878,-1.430188775062561,2.918060064315796,0.19189508259296417,-1.7203099727630615,0.8114314675331116,-0.1843033730983734,-1.535876750946045,1.3205983638763428,1.8700767755508423,-0.7460399866104126,-0.43611758947372437,-0.3235887885093689,0.6303156018257141,-0.7184423208236694,-1.0329530239105225,-0.7104982137680054,0.34250250458717346,0.680083155632019,-0.6463937163352966,0.21787455677986145,-0.6660702228546143,0.5430336594581604,-0.49094271659851074,1.2910658121109009,-0.4153355360031128,1.5730082988739014,-0.728708803653717,0.6035712957382202,-0.9085115790367126,-1.0032246112823486,-0.04783766716718674,-0.5709888935089111,2.503033399581909,1.6023720502853394,-0.56905198097229,-0.4209223985671997,-2.0840845108032227,-0.2639595866203308,0.3684641122817993,0.5525187253952026,1.5976970195770264,-1.9025696516036987,-0.04089619219303131,-0.584894597530365,0.24055492877960205,1.6613858938217163,-0.12024702876806259,-0.8347362279891968,1.7336639165878296,1.1750401258468628,-0.11903294920921326,0.6500970721244812,0.34783628582954407,-0.05771997570991516,-0.5915963053703308,0.36955469846725464,1.920599102973938,-0.2788347005844116,0.06880661845207214,-1.244016408920288,0.7917481660842896,0.06784187257289886,0.7907071113586426,-0.7809820175170898,1.473267674446106,-1.2362768650054932,0.1743253618478775,-0.9720405340194702,2.2491390705108643,0.8206822276115417,0.7763794660568237,-0.5229511260986328,1.4338513612747192,-1.3455778360366821,1.3166300058364868,1.2732658386230469,0.4826009273529053,1.2748050689697266,0.030332215130329132,-0.055270448327064514,-1.1775116920471191,1.046480655670166,-0.7027637362480164,-1.658735990524292,2.0262598991394043,-1.0369573831558228,0.7826532125473022,1.4502379894256592,-1.3898590803146362,1.4632036685943604,-0.6817280054092407,-0.44106778502464294,1.4090816974639893,0.04414789378643036,1.0341495275497437,-0.2938748300075531,-0.557404637336731,-0.8746922016143799,0.16932867467403412,1.0367604494094849,-1.8347280025482178,1.1540573835372925,1.8385450839996338,0.4166249930858612,1.2036548852920532,-1.239302158355713,-0.23379339277744293,-0.04332601651549339,0.16068893671035767,1.0824393033981323,0.4189317226409912,-1.6206996440887451,1.2818139791488647,-1.55466890335083,1.8002574443817139,0.07154247164726257,0.11675457656383514,-1.0217467546463013,0.7847180366516113,-0.4816895127296448,-0.19563448429107666,-1.0862013101577759,-1.5351660251617432,0.9425039887428284,-0.88552325963974,-1.1716047525405884,0.21250593662261963,-1.3097829818725586,0.2593306005001068,0.523629903793335,0.7365753054618835,-0.0053765736520290375,-1.519235610961914,-0.8657302856445312,-1.2686079740524292,-1.1530702114105225,1.3469074964523315,-0.06377129256725311,-0.41942912340164185,-0.4572140574455261,-0.497122198343277,0.14478635787963867,1.8115609884262085,0.3563310503959656,-1.048430323600769,0.38291120529174805,0.4790038764476776,-0.15766021609306335,-0.9140485525131226,-1.2840361595153809,-0.8751540780067444,-1.8118538856506348,0.24917791783809662,1.3893728256225586,-0.8792194128036499,0.4273020327091217,-1.9699060916900635,-0.1749536693096161,-1.665085792541504,-2.4425230026245117,-1.2567676305770874,-0.7281666398048401,-1.2737411260604858,0.9332252144813538,0.9362261295318604,-1.5250177383422852,-0.19883939623832703,-0.11819812655448914,0.9516333937644958,-0.5972231030464172,1.6166247129440308,-1.8100175857543945,0.9797428250312805,0.7051161527633667,-0.564605176448822,0.7895084023475647,-0.704731285572052,-0.6644103527069092,-0.778824508190155,-1.3469369411468506,2.272429943084717,-0.5881465077400208,-1.3309381008148193,0.6231070160865784,-1.0199291706085205,1.9235056638717651,0.4663686156272888,0.9035480618476868,1.3549951314926147,1.4918510913848877,0.7024498581886292,2.1990137100219727,0.28721553087234497,-0.8690239191055298,-0.29966503381729126,0.015478935092687607,-1.0799342393875122,-0.17697548866271973,0.6350167989730835,-0.3015808165073395,-1.4476436376571655,1.1591894626617432,0.9122928977012634,-1.6175389289855957,0.49170437455177307,-2.3431057929992676,0.8024666905403137,0.9893511533737183,1.749268651008606,0.5182934999465942,0.7721306681632996,0.43308472633361816,0.10689056664705276,0.3117094039916992,0.30726706981658936,-0.4296705722808838,3.121387243270874,0.6861550807952881,0.6306583285331726,-1.253255844116211,2.0520241260528564,-0.6936559677124023,-0.13391734659671783,1.2227869033813477,0.24813561141490936,2.438612937927246,0.001917421817779541,-1.1691629886627197,0.3172495365142822,-0.21913354098796844,-0.6621605157852173,0.6839551329612732,2.0111148357391357,-0.8503191471099854,0.8005342483520508,0.43410226702690125,1.5991754531860352,0.5923205614089966,-0.06380212306976318,1.2227451801300049,0.9433545470237732,-1.2697079181671143,1.1122238636016846,1.0462982654571533,-0.17393378913402557,1.6034210920333862,-1.3282577991485596,0.24623480439186096,-0.8371425867080688,1.395786166191101,0.2190561145544052,0.6423265933990479,-0.19426462054252625,2.0788419246673584,-1.2982019186019897,-0.3419319689273834,0.9257297515869141,-0.4049000144004822,-0.35508468747138977,-0.6792833805084229,1.8741481304168701,-0.2130386233329773,-1.2420305013656616,-2.048597812652588,0.4274747669696808,-2.3757517337799072,1.4171446561813354,-0.6398205757141113,0.7072250843048096,-0.3076234459877014,-0.9141883254051208,0.4071117043495178,1.1497416496276855,0.304290235042572,1.9184373617172241,-0.49060797691345215,-0.0011096931993961334,-1.4796878099441528,1.4085148572921753,-2.211855411529541,1.6717902421951294,1.6556715965270996,-0.8967130780220032,0.6205719709396362,-1.418558120727539,-0.7004110217094421,0.6845359802246094,-0.541139543056488,0.28055769205093384,-1.209580421447754,-1.7183096408843994,-1.202438473701477,-1.1744811534881592,1.3189599514007568,1.6645346879959106,-0.3431920111179352,-0.09752332419157028,-1.960963487625122
    ]], dtype=np.float32)
proba = 0.37092414
j = 27

# Load label
embeddings = "./models/embeddings_datasets.pickle"
le = "./models/le.pickle"

# Load pickle file
with open(embeddings,"rb") as f:
    data = pickle.load(f)
with open(le,"rb") as f:
    le = pickle.load(f)

embeddings = np.array(data['embeddings'])
labels = le.fit_transform(data['names'])         # แทนชื่อคนด้วยตัวเลข
print(labels)


# Cosine similarity
def findCosineDistance(vector1, vector2):
    vec1 = vector1.flatten()
    vec2 = vector2.flatten()

    a = np.dot(vec1.T,vec2)
    b = np.dot(vec1.T,vec1)
    c = np.dot(vec2.T,vec2)

    return 1 - (a/(np.sqrt(b)*np.sqrt(c)))
def CosineSimilarity(test_vec, source_vecs):
    cos_dist = 0
    for source_vec in source_vecs:
        cos_dist += findCosineDistance(test_vec, source_vec)
    return cos_dist/len(source_vecs)

cosine_threshold = 0.95
proba_threshold = 0.85

# similarity
match_class_idx = np.where(labels == j)[0]
selected_idx = np.random.choice(match_class_idx, 20)
# selected_idx
compare_embeddings = embeddings[selected_idx]
# compare_embeddings
cos_similarity = CosineSimilarity(embedding, compare_embeddings)
print("if cos_similarity < cosine_threshold and proba > proba_threshold:")
print(f"if {cos_similarity} < {cosine_threshold} and {proba} > {proba_threshold}:")
# if cos_similarity < cosine_threshold and proba > proba_threshold:
if cos_similarity < cosine_threshold:
    name = le.classes_[j]
    text = f"{name}"
    print(f"Recognized: {name} <{proba*100:.2f}>")

print(text)